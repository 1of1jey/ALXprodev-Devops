#!/bin/bash

# PokÃ©mon API Automation Script
# Fetches data for Pikachu and saves to data.json
# Logs errors to errors.txt if the request fails

API_URL="https://pokeapi.co/api/v2/pokemon/pikachu"
OUTPUT_FILE="data.json"
ERROR_FILE="errors.txt"

HTTP_RESPONSE=$(curl -s -w "\n%{http_code}" "$API_URL")

HTTP_CODE=$(echo "$HTTP_RESPONSE" | tail -n 1)

RESPONSE_BODY=$(echo "$HTTP_RESPONSE" | sed '$d')

if [ "$HTTP_CODE" -eq 200 ]; then
    echo "$RESPONSE_BODY" > "$OUTPUT_FILE"
    echo "Success! Pikachu data saved to $OUTPUT_FILE"
else
    # Log error with timestamp
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    echo "[$TIMESTAMP] Error: HTTP $HTTP_CODE - Failed to fetch data from $API_URL" >> "$ERROR_FILE"
    echo "Error: Request failed with HTTP code $HTTP_CODE. Check $ERROR_FILE for details."
    exit 1
fi
